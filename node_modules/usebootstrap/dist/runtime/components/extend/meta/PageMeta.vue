<template>
 <slot />
</template>

<script lang="ts" setup>
import { joinURL } from 'ufo';
import { useDynamicRouteParam } from '../../../composables/extend/dynamicRoute/useDynamicRouteParam';
import { useSeoMeta, useSiteConfig, useHead, ref, provide } from '#imports';
import { useRoute } from '#app';

const props = defineProps({
 url: String,
 title: String,
 description: String,
 image: String,
 twitter: {
  type: Boolean,
  default: true,
 },
 openGraph: {
  type: Boolean,
  default: true,
 },
});
const siteConfig = useSiteConfig();
const siteUrl = siteConfig?.url;
const siteName = siteConfig?.name;
const lang = useDynamicRouteParam('lang');
const route = useRoute();
const createImage = () => {
 if (siteUrl) {
  if (props.image) {
   return joinURL(siteUrl, props.image);
  }
  else if (siteConfig?.image) {
   return joinURL(siteUrl, siteConfig?.image);
  }
 }
 return undefined;
};
const pageImage = createImage();

useSeoMeta({
 title: props.title,
 description: props.description,
 ogTitle: props.title,
 ogSiteName: siteName,
 ogDescription: props.description,
 ogImage: pageImage,
 ogUrl: siteUrl,
 ogLocale: lang.value,
 twitterDescription: props.description,
 twitterCard: pageImage ? 'summary_large_image' : undefined,
 twitterImage: pageImage,
 twitterTitle: props.title,
});

const likedData = ref([]);
provide('likedData', likedData);

const website = {
 '@context': 'https://schema.org',
 '@type': 'WebSite',
 ...(siteUrl && { url: siteUrl }),
 ...(siteName && { name: siteName }),
};
const jsonLd = [
 website,
 ...(likedData.value ? likedData.value : []),
];

useHead({
 script: [
  {
   type: 'application/ld+json',
   innerHTML: JSON.stringify(jsonLd),
  },
 ],
});
route.meta.title = props.title;
route.meta.description = props.description;
</script>
